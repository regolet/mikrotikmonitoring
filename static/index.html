<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MikroTik Monitoring</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">MikroTik Monitoring</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="/" data-page="dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/groups" data-page="groups">Groups</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/settings" data-page="settings">Settings</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div id="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page-content">
            <div class="container-fluid mt-4">
                <!-- Network Summary -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">Network Summary</h3>
                        <div class="d-flex flex-wrap gap-2">
                            <div class="btn-group">
                                <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
                                    Auto-refresh: <span id="refresh-interval-display">Off</span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item refresh-option" href="#" data-interval="0">Off</a></li>
                                    <li><a class="dropdown-item refresh-option" href="#" data-interval="5">5 seconds</a></li>
                                    <li><a class="dropdown-item refresh-option" href="#" data-interval="10">10 seconds</a></li>
                                    <li><a class="dropdown-item refresh-option" href="#" data-interval="30">30 seconds</a></li>
                                    <li><a class="dropdown-item refresh-option" href="#" data-interval="60">1 minute</a></li>
                                </ul>
                            </div>
                            <button id="refresh-now" class="btn btn-primary">
                                <i class="bi bi-arrow-clockwise"></i> Refresh Now
                            </button>
                            <button id="export-data" class="btn btn-success">
                                <i class="bi bi-download"></i> Export Data
                            </button>
                            <button id="test-notification" class="btn btn-info">
                                <i class="bi bi-bell"></i> Test Notifications
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="seven-cards-row">
                                                <div class="stat-card-wrapper">
                        <div class="stat-card horizontal-card">
                            <div class="icon-container">
                                <i class="bi bi-people-fill"></i>
                            </div>
                            <div class="card-content">
                                <h3 class="mb-0" id="total-accounts">-</h3>
                                <p class="mb-0">Total Accounts</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card-wrapper">
                        <div class="stat-card horizontal-card bg-success bg-opacity-10">
                            <div class="icon-container">
                                <i class="bi bi-wifi text-success"></i>
                            </div>
                            <div class="card-content">
                                <h3 class="mb-0 text-success" id="online-accounts">-</h3>
                                <p class="mb-0">Online</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card-wrapper">
                        <div class="stat-card horizontal-card bg-danger bg-opacity-10">
                            <div class="icon-container">
                                <i class="bi bi-wifi-off text-danger"></i>
                            </div>
                            <div class="card-content">
                                <h3 class="mb-0 text-danger" id="offline-accounts">-</h3>
                                <p class="mb-0">Offline</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card-wrapper">
                        <div class="stat-card horizontal-card bg-info bg-opacity-10">
                            <div class="icon-container">
                                <i class="bi bi-toggle-on text-info"></i>
                            </div>
                            <div class="card-content">
                                <h3 class="mb-0 text-info" id="enabled-accounts">-</h3>
                                <p class="mb-0">Enabled</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card-wrapper">
                        <div class="stat-card horizontal-card bg-secondary bg-opacity-10">
                            <div class="icon-container">
                                <i class="bi bi-toggle-off text-secondary"></i>
                            </div>
                            <div class="card-content">
                                <h3 class="mb-0 text-secondary" id="disabled-accounts">-</h3>
                                <p class="mb-0">Disabled</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card-wrapper">
                        <div class="stat-card horizontal-card bg-info bg-opacity-10">
                            <div class="icon-container">
                                <i class="bi bi-cloud-arrow-up text-info"></i>
                            </div>
                            <div class="card-content">
                                <h3 class="mb-0 text-info" id="total-upload-speed">-</h3>
                                <p class="mb-0">Total Upload Speed</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card-wrapper">
                        <div class="stat-card horizontal-card bg-primary bg-opacity-10">
                            <div class="icon-container">
                                <i class="bi bi-cloud-arrow-down text-primary"></i>
                            </div>
                            <div class="card-content">
                                <h3 class="mb-0 text-primary" id="total-download-speed">-</h3>
                                <p class="mb-0">Total Download Speed</p>
                            </div>
                        </div>
                    </div>
                        </div>
                        <div class="row">
                            <div class="col-12 text-end">
                                <small class="text-muted">Last updated: <span id="last-updated-time">-</span></small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PPPoE Interfaces -->
                <div id="pppoe-section" style="display: none;">
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center gap-2 flex-grow-1">
                                <input id="pppoe-search" type="text" class="form-control form-control-sm" placeholder="Search..." style="max-width: 350px; width: 100%;">
                            </div>
                            <div>
                                <select id="pppoe-rows-per-page" class="form-select form-select-sm">
                                    <option value="10">10 rows</option>
                                    <option value="20" selected>20 rows</option>
                                    <option value="50">50 rows</option>
                                    <option value="100">100 rows</option>
                                    <option value="0">All</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-sm" id="pppoe-interfaces-table">
                                    <thead>
                                        <tr>
                                            <th class="sortable" data-sort="name">
                                                Name <i class="bi bi-arrow-down-up sort-icon"></i>
                                            </th>
                                            <th class="sortable" data-sort="profile">
                                                Profile Plan <i class="bi bi-arrow-down-up sort-icon"></i>
                                            </th>
                                            <th class="sortable" data-sort="status">
                                                Status <i class="bi bi-arrow-down-up sort-icon"></i>
                                            </th>
                                            <th class="sortable" data-sort="download">
                                                Download Speed (Mbps) <i class="bi bi-arrow-down-up sort-icon"></i>
                                            </th>
                                            <th class="sortable" data-sort="upload">
                                                Upload Speed (Mbps) <i class="bi bi-arrow-down-up sort-icon"></i>
                                            </th>
                                            <th class="sortable" data-sort="address">
                                                Address <i class="bi bi-arrow-down-up sort-icon"></i>
                                            </th>
                                            <th class="sortable" data-sort="uptime">
                                                Uptime <i class="bi bi-arrow-down-up sort-icon"></i>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- PPPoE interfaces will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    Showing <span id="pppoe-showing-start">0</span> to <span id="pppoe-showing-end">0</span> of <span id="pppoe-total-rows">0</span> entries
                                </div>
                                <div>
                                    <nav aria-label="PPPoE table navigation">
                                        <ul class="pagination pagination-sm mb-0">
                                            <li class="page-item">
                                                <button id="pppoe-prev-page" class="page-link" aria-label="Previous">
                                                    <span aria-hidden="true">&laquo;</span>
                                                </button>
                                            </li>
                                            <li class="page-item">
                                                <span class="page-link">Page <span id="pppoe-current-page">1</span></span>
                                            </li>
                                            <li class="page-item">
                                                <button id="pppoe-next-page" class="page-link" aria-label="Next">
                                                    <span aria-hidden="true">&raquo;</span>
                                                </button>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Groups Page -->
        <div id="groups-page" class="page-content" style="display: none;">
            <div class="container-fluid mt-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3>Groups Management</h3>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGroupModal">
                            <i class="bi bi-plus-circle"></i> Add Group
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="groups-content">
                            <!-- Groups will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page-content" style="display: none;">
            <div class="container-fluid mt-4">
                <div class="card">
                    <div class="card-header">
                        <h3>Router Settings</h3>
                    </div>
                    <div class="card-body">
                        <form id="settings-form">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="router_ip" class="form-label">Router IP Address</label>
                                        <input type="text" class="form-control" id="router_ip" name="router_ip" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="router_port" class="form-label">Port</label>
                                        <input type="number" class="form-control" id="router_port" name="router_port" value="8728" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="router_user" class="form-label">Username</label>
                                        <input type="text" class="form-control" id="router_user" name="router_user" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="router_password" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="router_password" name="router_password" required>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save"></i> Save Settings
                                </button>
                                <button type="button" class="btn btn-secondary" id="test-connection">
                                    <i class="bi bi-wifi"></i> Test Connection
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Group Modal -->
    <div class="modal fade" id="addGroupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Group</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-group-form">
                        <div class="mb-3">
                            <label for="group-name" class="form-label">Group Name</label>
                            <input type="text" class="form-control" id="group-name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Group Members</label>
                            <div class="row">
                                <div class="col-md-5">
                                    <label class="form-label text-muted">Available Accounts</label>
                                    <select id="available-accounts" class="form-select" size="8" multiple>
                                        <!-- Available accounts will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="col-md-2 d-flex flex-column justify-content-center align-items-center">
                                    <button type="button" class="btn btn-sm btn-outline-primary mb-2" id="add-members">
                                        <i class="bi bi-arrow-right"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="remove-members">
                                        <i class="bi bi-arrow-left"></i>
                                    </button>
                                </div>
                                <div class="col-md-5">
                                    <label class="form-label text-muted">Selected Members</label>
                                    <select id="selected-members" class="form-select" size="8" multiple>
                                        <!-- Selected members will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-group-btn">Save Group</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Group Modal -->
    <div class="modal fade" id="editGroupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Group</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-group-form">
                        <input type="hidden" id="edit-group-id">
                        <div class="mb-3">
                            <label for="edit-group-name" class="form-label">Group Name</label>
                            <input type="text" class="form-control" id="edit-group-name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Group Members</label>
                            <div class="row">
                                <div class="col-md-5">
                                    <label class="form-label text-muted">Available Accounts</label>
                                    <select id="edit-available-accounts" class="form-select" size="8" multiple>
                                        <!-- Available accounts will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="col-md-2 d-flex flex-column justify-content-center align-items-center">
                                    <button type="button" class="btn btn-sm btn-outline-primary mb-2" id="edit-add-members">
                                        <i class="bi bi-arrow-right"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="edit-remove-members">
                                        <i class="bi bi-arrow-left"></i>
                                    </button>
                                </div>
                                <div class="col-md-5">
                                    <label class="form-label text-muted">Selected Members</label>
                                    <select id="edit-selected-members" class="form-select" size="8" multiple>
                                        <!-- Selected members will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="update-group-btn">Update Group</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Notification Container -->
    <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100;"></div>

    <footer class="footer mt-5">
        <div class="container text-center py-3">
            <p>MikroTik Monitoring &copy; 2024</p>
            <p class="text-muted">Last updated: <span id="footer-time">-</span></p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Bootstrap Toast Notification Helper -->
    <script>
    function showToast(message, type = 'info', title = '') {
        const toastId = 'toast-' + Date.now();
        const icon = type === 'success' ? 'bi-check-circle-fill' : type === 'error' ? 'bi-x-circle-fill' : type === 'warning' ? 'bi-exclamation-triangle-fill' : 'bi-info-circle-fill';
        const header = title ? `<strong class="me-auto"><i class="bi ${icon} me-2"></i>${title}</strong>` : '';
        const toastHtml = `
            <div id="${toastId}" class="toast align-items-center text-bg-${type === 'error' ? 'danger' : type} border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        ${header}
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>`;
        const container = document.getElementById('toast-container');
        container.insertAdjacentHTML('beforeend', toastHtml);
        const toastEl = document.getElementById(toastId);
        const toast = new bootstrap.Toast(toastEl, { delay: 4000 });
        toast.show();
        toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
    }
    // Simple aliases for compatibility
    window.showSuccess = (title, message) => showToast(message, 'success', title);
    window.showError = (title, message) => showToast(message, 'danger', title);
    window.showWarning = (title, message) => showToast(message, 'warning', title);
    window.showInfo = (title, message) => showToast(message, 'info', title);
    </script>

    <!-- Main Application Logic -->
    <script>
        class MikroTikSPA {
            constructor() {
                this.currentPage = 'dashboard';
                this.refreshInterval = null;
                this.currentData = {};
                this.pppoePage = 1;
                this.rowsPerPage = 20;
                this.sortColumn = 'name';
                this.sortDirection = 'asc';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupRouting();
                this.loadCurrentPage();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('[data-page]').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = e.target.dataset.page;
                        this.navigateTo(page);
                    });
                });

                // Dashboard controls
                document.getElementById('refresh-now')?.addEventListener('click', () => {
                    this.refreshDashboardData();
                });

                document.getElementById('export-data')?.addEventListener('click', () => {
                    this.exportData();
                });

                document.getElementById('test-notification')?.addEventListener('click', () => {
                    this.testNotifications();
                });

                // Auto-refresh options
                document.querySelectorAll('.refresh-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.preventDefault();
                        const interval = parseInt(e.target.dataset.interval);
                        this.setRefreshInterval(interval);
                    });
                });

                // Settings form
                document.getElementById('settings-form')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveSettings();
                });

                document.getElementById('test-connection')?.addEventListener('click', () => {
                    this.testConnection();
                });

                // Groups functionality
                document.getElementById('save-group-btn')?.addEventListener('click', () => {
                    this.saveGroup();
                });

                document.getElementById('update-group-btn')?.addEventListener('click', () => {
                    this.updateGroup();
                });

                // Dual list select functionality
                document.getElementById('add-members')?.addEventListener('click', () => {
                    this.transferMembers('available-accounts', 'selected-members');
                });

                document.getElementById('remove-members')?.addEventListener('click', () => {
                    this.transferMembers('selected-members', 'available-accounts');
                });

                document.getElementById('edit-add-members')?.addEventListener('click', () => {
                    this.transferMembers('edit-available-accounts', 'edit-selected-members');
                });

                document.getElementById('edit-remove-members')?.addEventListener('click', () => {
                    this.transferMembers('edit-selected-members', 'edit-available-accounts');
                });

                // Modal show events for dual list population
                document.getElementById('addGroupModal')?.addEventListener('show.bs.modal', () => {
                    this.populateDualList('available-accounts', 'selected-members');
                });

                // PPPoE table sorting
                document.querySelectorAll('#pppoe-interfaces-table th.sortable').forEach(th => {
                    th.addEventListener('click', (e) => {
                        const sortField = th.dataset.sort;
                        this.sortPPPoETable(sortField);
                    });
                });

                // Add event listener for PPPoE search
                const pppoeSearchInput = document.getElementById('pppoe-search');
                if (pppoeSearchInput) {
                    pppoeSearchInput.addEventListener('input', (e) => {
                        this.filterPPPoETable(e.target.value);
                    });
                }
            }

            setupRouting() {
                // Handle browser back/forward
                window.addEventListener('popstate', (e) => {
                    const page = e.state?.page || 'dashboard';
                    this.showPage(page);
                });

                // Initial route
                const path = window.location.pathname;
                if (path === '/settings') {
                    this.navigateTo('settings');
                } else if (path === '/groups') {
                    this.navigateTo('groups');
                } else {
                    this.navigateTo('dashboard');
                }
            }

            navigateTo(page) {
                this.currentPage = page;
                this.showPage(page);
                window.history.pushState({ page }, '', `/${page === 'dashboard' ? '' : page}`);
                
                // Update navigation active state
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
            }

            showPage(page) {
                // Hide all pages
                document.querySelectorAll('.page-content').forEach(content => {
                    content.style.display = 'none';
                });

                // Show selected page
                const pageElement = document.getElementById(`${page}-page`);
                if (pageElement) {
                    pageElement.style.display = 'block';
                }

                // Load page-specific data
                this.loadCurrentPage();
            }

            loadCurrentPage() {
                switch (this.currentPage) {
                    case 'dashboard':
                        this.loadDashboardData();
                        break;
                    case 'groups':
                        this.loadGroups();
                        break;
                    case 'settings':
                        this.loadSettings();
                        break;
                }
            }

            async loadDashboardData() {
                await this.checkConnection();
                if (this.currentData.connected) {
                    await this.refreshDashboardData();
                }
            }

            async checkConnection() {
                try {
                    const response = await fetch('/api/status');
                    const data = await response.json();
                    
                    this.currentData.connected = data.connected;
                    
                    if (data.connected) {
                        showSuccess('Connected', 'Successfully connected to MikroTik router');
                    } else {
                        showError('Connection Failed', 'Unable to connect to MikroTik router');
                    }
                } catch (error) {
                    console.error('Error checking connection:', error);
                    showError('Connection Error', 'Failed to connect to server');
                }
            }

            async refreshDashboardData() {
                try {
                    const response = await fetch('/api/pppoe');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.currentData.pppoe = data;
                        this.updateDashboard();
                    } else {
                        showError('Data Error', data.error || 'Failed to load data');
                    }
                } catch (error) {
                    console.error('Error refreshing data:', error);
                    showError('Refresh Error', 'Failed to refresh data');
                }
            }

            updateDashboard() {
                if (this.currentData.pppoe && this.currentData.pppoe.aggregate_stats) {
                    const stats = this.currentData.pppoe.aggregate_stats;
                    document.getElementById('total-accounts').textContent = stats.total_accounts || 0;
                    document.getElementById('online-accounts').textContent = stats.online_accounts || 0;
                    document.getElementById('offline-accounts').textContent = stats.offline_accounts || 0;
                    document.getElementById('enabled-accounts').textContent = stats.enabled_accounts || 0;
                    document.getElementById('disabled-accounts').textContent = stats.disabled_accounts || 0;
                }

                // Update PPPoE table and calculate speeds
                const processedInterfaces = this.updatePPPoETable();
                this.updateSpeedCalculations(processedInterfaces);
                // Reapply PPPoE search filter after table update
                const searchInput = document.getElementById('pppoe-search');
                if (searchInput) {
                    this.filterPPPoETable(searchInput.value);
                }
                this.updateFooter();
            }

            updatePPPoETable() {
                const section = document.getElementById('pppoe-section');
                const tbody = document.querySelector('#pppoe-interfaces-table tbody');
                
                if (!this.currentData.pppoe || !this.currentData.pppoe.pppoe_interfaces) {
                    section.style.display = 'none';
                    return [];
                }

                const interfaces = this.currentData.pppoe.pppoe_interfaces;
                const pppSecrets = this.currentData.pppoe.ppp_secrets || [];
                const pppActive = this.currentData.pppoe.ppp_active || [];
                
                // Create a map of PPP secrets for quick lookup
                const pppAccountMap = {};
                pppSecrets.forEach(acc => {
                    if (acc.name) pppAccountMap[acc.name.toLowerCase()] = acc;
                    if (acc.username) pppAccountMap[acc.username.toLowerCase()] = acc;
                });

                // Build a map for quick lookup by name and address
                const pppActiveMap = {};
                pppActive.forEach(entry => {
                    if (entry.name) pppActiveMap[entry.name.toLowerCase()] = entry;
                    if (entry.address) pppActiveMap[entry.address] = entry;
                });

                // Process interfaces with speed calculations and account matching
                const processedInterfaces = interfaces.map(iface => {
                    // Try to match PPPoE interface name to PPP account
                    let accountName = iface.name || 'N/A';
                    let profilePlan = iface.profile || 'N/A';
                    
                    // Extract username from interface name if it matches <pppoe-username> pattern
                    const match = iface.name.match(/^<pppoe-(.+)>$/i);
                    if (match && match[1]) {
                        const username = match[1].toLowerCase();
                        const account = pppAccountMap[username];
                        if (account) {
                            accountName = account.name || account.username || iface.name;
                            profilePlan = account.profile || 'N/A';
                        }
                    } else {
                        // Try direct name matching
                        const account = pppAccountMap[iface.name.toLowerCase()];
                        if (account) {
                            accountName = account.name || account.username || iface.name;
                            profilePlan = account.profile || 'N/A';
                        }
                    }
                    
                    // Calculate speeds for this interface
                    const rxBytes = parseFloat(iface['rx-byte'] || 0);
                    const txBytes = parseFloat(iface['tx-byte'] || 0);
                    
                    // Calculate rates using localStorage pattern
                    let calculatedRxRateBps = 0;
                    let calculatedTxRateBps = 0;
                    
                    const interfaceName = iface.name;
                    const storageKey = `pppoe_stats_${interfaceName}`;
                    const currentTime = Date.now();
                    
                    // Get previous stats from localStorage
                    const prevStatsStr = localStorage.getItem(storageKey);
                    if (prevStatsStr) {
                        try {
                            const prevStats = JSON.parse(prevStatsStr);
                            const timeDiff = (currentTime - prevStats.timestamp) / 1000;
                            
                            if (timeDiff > 0) {
                                let rxDiff = rxBytes - prevStats.rxBytes;
                                let txDiff = txBytes - prevStats.txBytes;
                                
                                // Handle counter wrapping
                                rxDiff = rxDiff < 0 ? rxBytes : rxDiff;
                                txDiff = txDiff < 0 ? txBytes : txDiff;
                                
                                calculatedRxRateBps = Math.max(0, rxDiff / timeDiff);
                                calculatedTxRateBps = Math.max(0, txDiff / timeDiff);
                            }
                        } catch (e) {
                            console.warn('Error parsing previous stats for', interfaceName, e);
                        }
                    }
                    
                    // Store current values for next calculation
                    const currentStats = {
                        rxBytes: rxBytes,
                        txBytes: txBytes,
                        timestamp: currentTime
                    };
                    localStorage.setItem(storageKey, JSON.stringify(currentStats));
                    
                    return {
                        ...iface,
                        accountName: accountName,
                        profilePlan: profilePlan,
                        calculatedRxRateBps: calculatedRxRateBps,
                        calculatedTxRateBps: calculatedTxRateBps,
                        status: iface.running === 'true' ? 'Up' : 'Down',
                        statusClass: iface.running === 'true' ? 'status-up' : 'status-down'
                    };
                });

                // Sort the processed interfaces
                this.sortInterfaces(processedInterfaces);

                const total = processedInterfaces.length;
                const start = (this.pppoePage - 1) * this.rowsPerPage;
                const end = Math.min(start + this.rowsPerPage, total);
                const pageData = processedInterfaces.slice(start, end);

                if (total > 0) {
                    section.style.display = 'block';
                    tbody.innerHTML = pageData.map(iface => {
                        // Try to find a matching PPP active entry
                        let activeEntry = null;
                        if (iface.accountName && pppActiveMap[iface.accountName.toLowerCase()]) {
                            activeEntry = pppActiveMap[iface.accountName.toLowerCase()];
                        } else if (iface.address && pppActiveMap[iface.address]) {
                            activeEntry = pppActiveMap[iface.address];
                        }
                        const address = activeEntry ? (activeEntry.address || activeEntry['remote-address']) : (iface.address || iface['remote-address']);
                        const uptime = activeEntry ? activeEntry.uptime : (iface.uptime || iface['uptime']);
                        return `
                            <tr class="${iface.running === 'true' ? 'table-default' : 'table-secondary'}">
                                <td>${iface.accountName}</td>
                                <td>${iface.profilePlan}</td>
                                <td>
                                    <span class="status-indicator ${iface.statusClass}"></span>
                                    ${iface.status}
                                </td>
                                <td>${this.formatMbps(iface.calculatedTxRateBps)}</td>
                                <td>${this.formatMbps(iface.calculatedRxRateBps)}</td>
                                <td>${address || 'N/A'}</td>
                                <td>${uptime || 'N/A'}</td>
                            </tr>
                        `;
                    }).join('');

                    // Update pagination info
                    document.getElementById('pppoe-showing-start').textContent = total === 0 ? 0 : start + 1;
                    document.getElementById('pppoe-showing-end').textContent = end;
                    document.getElementById('pppoe-total-rows').textContent = total;
                    document.getElementById('pppoe-current-page').textContent = this.pppoePage;
                    
                    // Set up pagination controls
                    const prevBtn = document.getElementById('pppoe-prev-page');
                    const nextBtn = document.getElementById('pppoe-next-page');
                    const rowsSelect = document.getElementById('pppoe-rows-per-page');
                    
                    if (prevBtn) {
                        prevBtn.onclick = () => {
                            if (this.pppoePage > 1) {
                                this.pppoePage--;
                                this.updatePPPoETable();
                            }
                        };
                    }
                    
                    if (nextBtn) {
                        nextBtn.onclick = () => {
                            const totalPages = Math.ceil(total / this.rowsPerPage);
                            if (this.pppoePage < totalPages) {
                                this.pppoePage++;
                                this.updatePPPoETable();
                            }
                        };
                    }
                    
                    if (rowsSelect) {
                        rowsSelect.onchange = () => {
                            this.rowsPerPage = parseInt(rowsSelect.value) || 20;
                            this.pppoePage = 1;
                            this.updatePPPoETable();
                        };
                    }
                } else {
                    section.style.display = 'none';
                }
                
                return processedInterfaces;
            }

            sortPPPoETable(sortField) {
                // Toggle sort direction if same column
                if (this.sortColumn === sortField) {
                    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortColumn = sortField;
                    this.sortDirection = 'asc';
                }

                // Update sort icons
                document.querySelectorAll('#pppoe-interfaces-table th.sortable').forEach(th => {
                    const icon = th.querySelector('.sort-icon');
                    if (th.dataset.sort === sortField) {
                        icon.className = this.sortDirection === 'asc' ? 'bi bi-arrow-up sort-icon' : 'bi bi-arrow-down sort-icon';
                    } else {
                        icon.className = 'bi bi-arrow-down-up sort-icon';
                    }
                });

                // Reset to first page when sorting
                this.pppoePage = 1;
                
                // Update the table
                this.updatePPPoETable();
            }

            sortInterfaces(interfaces) {
                interfaces.sort((a, b) => {
                    let aValue, bValue;
                    
                    switch (this.sortColumn) {
                        case 'name':
                            aValue = a.accountName.toLowerCase();
                            bValue = b.accountName.toLowerCase();
                            break;
                        case 'profile':
                            aValue = a.profilePlan.toLowerCase();
                            bValue = b.profilePlan.toLowerCase();
                            break;
                        case 'status':
                            aValue = a.status.toLowerCase();
                            bValue = b.status.toLowerCase();
                            break;
                        case 'download':
                            aValue = a.calculatedTxRateBps;
                            bValue = b.calculatedTxRateBps;
                            break;
                        case 'upload':
                            aValue = a.calculatedRxRateBps;
                            bValue = b.calculatedRxRateBps;
                            break;
                        case 'address':
                            aValue = this.ipToNumber(a.address || a['remote-address']);
                            bValue = this.ipToNumber(b.address || b['remote-address']);
                            break;
                        case 'uptime':
                            aValue = this.uptimeToSeconds(a.uptime || a['uptime']);
                            bValue = this.uptimeToSeconds(b.uptime || b['uptime']);
                            break;
                        default:
                            aValue = a.accountName.toLowerCase();
                            bValue = b.accountName.toLowerCase();
                    }
                    
                    // Handle numeric sorting
                    if (this.sortColumn === 'download' || this.sortColumn === 'upload') {
                        if (this.sortDirection === 'asc') {
                            return aValue - bValue;
                        } else {
                            return bValue - aValue;
                        }
                    }
                    
                    // Handle string sorting
                    if (typeof aValue === 'string' && typeof bValue === 'string') {
                        if (this.sortDirection === 'asc') {
                            return aValue.localeCompare(bValue);
                        } else {
                            return bValue.localeCompare(aValue);
                        }
                    } else {
                        // Numeric or mixed types
                        if (this.sortDirection === 'asc') {
                            return aValue - bValue;
                        } else {
                            return bValue - aValue;
                        }
                    }
                });
            }

            updateSpeedCalculations(processedInterfaces = null) {
                if (!processedInterfaces || processedInterfaces.length === 0) {
                    document.getElementById('total-upload-speed').textContent = '-';
                    document.getElementById('total-download-speed').textContent = '-';
                    return;
                }

                let totalDownloadRate = 0;
                let totalUploadRate = 0;

                // Use the processed interfaces that already have speed calculations
                processedInterfaces.forEach(iface => {
                    totalDownloadRate += iface.calculatedTxRateBps || 0;
                    totalUploadRate += iface.calculatedRxRateBps || 0;
                });

                // Update total speed displays
                document.getElementById('total-download-speed').textContent = this.formatMbps(totalDownloadRate);
                document.getElementById('total-upload-speed').textContent = this.formatMbps(totalUploadRate);
            }

            async loadGroups() {
                try {
                    // Fetch both groups and PPP active data
                    const [groupsResponse, pppActiveResponse] = await Promise.all([
                        fetch('/api/groups'),
                        fetch('/api/ppp_active')
                    ]);
                    
                    const groupsData = await groupsResponse.json();
                    const pppActiveData = await pppActiveResponse.json();
                    
                    if (groupsData.success) {
                        const groups = groupsData.groups || [];
                        const pppActive = pppActiveData.success ? pppActiveData.ppp_active || [] : [];
                        
                        // Create a set of online usernames for quick lookup
                        const onlineUsernames = new Set(pppActive.map(conn => conn.name));
                        
                        // Add online status to each group's accounts
                        groups.forEach(group => {
                            if (group.accounts) {
                                group.accounts = group.accounts.map(account => ({
                                    name: account,
                                    online: onlineUsernames.has(account)
                                }));
                            }
                        });
                        
                        this.renderGroups(groups);
                    } else {
                        showError('Groups Error', groupsData.error || 'Failed to load groups');
                    }
                } catch (error) {
                    console.error('Error loading groups:', error);
                    showError('Groups Error', 'Failed to load groups');
                }
            }

            renderGroups(groups) {
                const content = document.getElementById('groups-content');
                
                if (groups.length === 0) {
                    content.innerHTML = '<div class="alert alert-info">No groups found. Create your first group!</div>';
                    return;
                }

                content.innerHTML = `
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        ${groups.map(group => {
                            // Calculate online/offline status
                            const totalMembers = group.accounts ? group.accounts.length : 0;
                            const onlineMembers = group.accounts ? group.accounts.filter(acc => acc.online).length : 0;
                            const offlineMembers = totalMembers - onlineMembers;
                            
                            // Determine header color based on status
                            let headerClass = 'bg-primary'; // default
                            if (totalMembers > 0) {
                                const onlinePercentage = (onlineMembers / totalMembers) * 100;
                                if (onlinePercentage === 100) {
                                    headerClass = 'bg-success'; // All online - Green
                                } else if (onlinePercentage === 0) {
                                    headerClass = 'bg-danger'; // All offline - Red
                                } else if (offlineMembers >= totalMembers * 0.5) {
                                    headerClass = 'bg-danger'; // >50% offline - Red
                                } else if (offlineMembers === totalMembers * 0.5) {
                                    headerClass = 'bg-warning'; // Exactly 50% offline - Orange
                                } else {
                                    headerClass = 'bg-primary'; // <50% offline - Blue
                                }
                            }
                            
                            return `
                                <div class="col">
                                    <div class="card h-100 shadow-sm">
                                        <div class="card-header ${headerClass} text-white">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="d-flex align-items-center gap-3">
                                                    <h5 class="card-title mb-0">${group.name}</h5>
                                                    <span class="badge bg-success">Online: ${onlineMembers}</span>
                                                    <span class="badge bg-secondary">Offline: ${offlineMembers}</span>
                                                </div>
                                                <div class="d-flex gap-2">
                                                    <button class="btn btn-sm btn-outline-light" onclick="app.editGroup('${group.id}')">
                                                        <i class="bi bi-pencil"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-light" onclick="app.deleteGroup('${group.id}')">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text">
                                                <strong>Members:</strong><br>
                                                <span>
                                                    ${group.accounts && group.accounts.length > 0 
                                                        ? group.accounts.map(acc => `<span class='badge me-1 ${acc.online ? "bg-success" : "bg-danger"}'>${acc.name}</span>`).join(' ')
                                                        : 'No members'
                                                    }
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            transferMembers(fromId, toId) {
                const fromSelect = document.getElementById(fromId);
                const toSelect = document.getElementById(toId);
                
                if (!fromSelect || !toSelect) return;
                
                const selectedOptions = Array.from(fromSelect.selectedOptions);
                selectedOptions.forEach(option => {
                    toSelect.appendChild(option);
                });
            }

            async loadAvailableAccounts() {
                try {
                    const response = await fetch('/api/ppp_accounts');
                    const data = await response.json();
                    
                    if (data.success && data.ppp_accounts) {
                        return data.ppp_accounts.map(account => account.name);
                    }
                    return [];
                } catch (error) {
                    console.error('Error loading accounts:', error);
                    return [];
                }
            }

            async populateDualList(availableSelectId, selectedSelectId, selectedAccounts = []) {
                const availableSelect = document.getElementById(availableSelectId);
                const selectedSelect = document.getElementById(selectedSelectId);
                
                if (!availableSelect || !selectedSelect) return;
                
                // Clear existing options
                availableSelect.innerHTML = '';
                selectedSelect.innerHTML = '';
                
                // Load all available accounts
                const allAccounts = await this.loadAvailableAccounts();
                
                // Populate available accounts (excluding already selected ones)
                allAccounts.forEach(account => {
                    if (!selectedAccounts.includes(account)) {
                        const option = document.createElement('option');
                        option.value = account;
                        option.textContent = account;
                        availableSelect.appendChild(option);
                    }
                });
                
                // Populate selected accounts
                selectedAccounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account;
                    option.textContent = account;
                    selectedSelect.appendChild(option);
                });
            }

            getSelectedMembers(selectedSelectId) {
                const selectedSelect = document.getElementById(selectedSelectId);
                if (!selectedSelect) return [];
                
                return Array.from(selectedSelect.options).map(option => option.value);
            }

            async saveGroup() {
                const name = document.getElementById('group-name').value.trim();
                const selectedMembers = this.getSelectedMembers('selected-members');
                
                if (!name) {
                    showError('Validation Error', 'Group name is required');
                    return;
                }

                try {
                    const response = await fetch('/api/groups', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            name, 
                            accounts: selectedMembers 
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess('Group Created', 'Group saved successfully');
                        document.getElementById('group-name').value = '';
                        document.getElementById('selected-members').innerHTML = '';
                        document.getElementById('available-accounts').innerHTML = '';
                        bootstrap.Modal.getInstance(document.getElementById('addGroupModal')).hide();
                        this.loadGroups();
                    } else {
                        showError('Save Error', data.error || 'Failed to save group');
                    }
                } catch (error) {
                    console.error('Error saving group:', error);
                    showError('Save Error', 'Failed to save group');
                }
            }

            async editGroup(groupId) {
                // Load group data and populate edit modal
                try {
                    const response = await fetch('/api/groups');
                    const data = await response.json();
                    
                    if (data.success) {
                        const group = data.groups.find(g => g.id === groupId);
                        if (group) {
                            document.getElementById('edit-group-id').value = group.id;
                            document.getElementById('edit-group-name').value = group.name;
                            
                            // Populate dual list with current group members
                            await this.populateDualList(
                                'edit-available-accounts', 
                                'edit-selected-members', 
                                group.accounts || []
                            );
                            
                            const modal = new bootstrap.Modal(document.getElementById('editGroupModal'));
                            modal.show();
                        }
                    }
                } catch (error) {
                    console.error('Error loading group for edit:', error);
                    showError('Edit Error', 'Failed to load group data');
                }
            }

            async updateGroup() {
                const id = document.getElementById('edit-group-id').value;
                const name = document.getElementById('edit-group-name').value.trim();
                const selectedMembers = this.getSelectedMembers('edit-selected-members');
                
                if (!name) {
                    showError('Validation Error', 'Group name is required');
                    return;
                }

                try {
                    const response = await fetch('/api/groups', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            id, 
                            name, 
                            accounts: selectedMembers 
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess('Group Updated', 'Group updated successfully');
                        bootstrap.Modal.getInstance(document.getElementById('editGroupModal')).hide();
                        this.loadGroups();
                    } else {
                        showError('Update Error', data.error || 'Failed to update group');
                    }
                } catch (error) {
                    console.error('Error updating group:', error);
                    showError('Update Error', 'Failed to update group');
                }
            }

            async deleteGroup(groupId) {
                if (!confirm('Are you sure you want to delete this group?')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/groups?id=${groupId}`, {
                        method: 'DELETE'
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess('Group Deleted', 'Group deleted successfully');
                        this.loadGroups();
                    } else {
                        showError('Delete Error', data.error || 'Failed to delete group');
                    }
                } catch (error) {
                    console.error('Error deleting group:', error);
                    showError('Delete Error', 'Failed to delete group');
                }
            }

            async loadSettings() {
                try {
                    const response = await fetch('/api/settings');
                    const data = await response.json();
                    
                    if (data.success) {
                        document.getElementById('router_ip').value = data.router_ip || '';
                        document.getElementById('router_port').value = data.router_port || 8728;
                        document.getElementById('router_user').value = data.router_user || '';
                        document.getElementById('router_password').value = '';
                    } else {
                        showError('Settings Error', data.error || 'Failed to load settings');
                    }
                } catch (error) {
                    console.error('Error loading settings:', error);
                    showError('Settings Error', 'Failed to load settings');
                }
            }

            async saveSettings() {
                const formData = new FormData(document.getElementById('settings-form'));
                const settings = {
                    router_ip: formData.get('router_ip'),
                    router_port: parseInt(formData.get('router_port')),
                    router_user: formData.get('router_user'),
                    router_password: formData.get('router_password')
                };

                try {
                    const response = await fetch('/api/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(settings)
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess('Settings Saved', 'Settings updated successfully');
                    } else {
                        showError('Save Error', data.error || 'Failed to save settings');
                    }
                } catch (error) {
                    console.error('Error saving settings:', error);
                    showError('Save Error', 'Failed to save settings');
                }
            }

            async testConnection() {
                try {
                    const response = await fetch('/api/status');
                    const data = await response.json();
                    
                    if (data.success && data.connected) {
                        showSuccess('Connection Test', 'Successfully connected to router');
                    } else {
                        showError('Connection Test', 'Failed to connect to router');
                    }
                } catch (error) {
                    console.error('Error testing connection:', error);
                    showError('Connection Test', 'Failed to test connection');
                }
            }

            async exportData() {
                try {
                    showInfo('Export Started', 'Preparing data for download...');
                    const response = await fetch('/api/export');
                    const data = await response.json();
                    
                    if (data.success) {
                        const blob = new Blob([JSON.stringify(data.data, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `mikrotik-export-${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        showSuccess('Export Complete', 'Data exported successfully');
                    } else {
                        showError('Export Failed', data.error || 'Unknown error');
                    }
                } catch (error) {
                    console.error('Export error:', error);
                    showError('Export Error', 'Failed to export data');
                }
            }

            testNotifications() {
                showSuccess('Success Notification', 'This is a success message');
                setTimeout(() => {
                    showError('Error Notification', 'This is an error message');
                }, 1000);
                setTimeout(() => {
                    showWarning('Warning Notification', 'This is a warning message');
                }, 2000);
                setTimeout(() => {
                    showInfo('Info Notification', 'This is an info message');
                }, 3000);
            }

            setRefreshInterval(seconds) {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                    this.refreshInterval = null;
                }
                
                const display = document.getElementById('refresh-interval-display');
                display.textContent = seconds > 0 ? seconds + ' seconds' : 'Off';
                
                if (seconds > 0) {
                    this.refreshInterval = setInterval(() => {
                        if (this.currentPage === 'dashboard') {
                            this.refreshDashboardData();
                        } else if (this.currentPage === 'groups') {
                            this.loadGroups();
                        }
                    }, seconds * 1000);
                }
                
                localStorage.setItem('refreshInterval', seconds.toString());
            }

            updateFooter() {
                const now = new Date().toLocaleString();
                document.getElementById('footer-time').textContent = now;
                document.getElementById('last-updated-time').textContent = now;
            }

            formatMbps(bps, decimals = 2) {
                if (!bps || bps <= 0) return '0 Mbps';
                return (bps * 8 / 1_000_000).toFixed(decimals) + ' Mbps';
            }

            // Helper to convert IP address to a number for sorting
            ipToNumber(ip) {
                if (!ip) return 0;
                return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0);
            }

            // Helper to parse uptime string (e.g., '4d4h30m5s') to seconds
            uptimeToSeconds(uptime) {
                if (!uptime) return 0;
                let total = 0;
                const regex = /(?:(\d+)d)?(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/;
                const match = uptime.match(regex);
                if (match) {
                    total += (parseInt(match[1] || 0, 10) * 86400); // days
                    total += (parseInt(match[2] || 0, 10) * 3600);  // hours
                    total += (parseInt(match[3] || 0, 10) * 60);    // minutes
                    total += (parseInt(match[4] || 0, 10));         // seconds
                }
                return total;
            }

            filterPPPoETable(query) {
                const tbody = document.querySelector('#pppoe-interfaces-table tbody');
                if (!tbody) return;
                const rows = Array.from(tbody.querySelectorAll('tr'));
                const q = query.trim().toLowerCase();
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(q) ? '' : 'none';
                });
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new MikroTikSPA();
            
            // Load saved refresh interval
            const savedInterval = localStorage.getItem('refreshInterval');
            if (savedInterval) {
                window.app.setRefreshInterval(parseInt(savedInterval));
            }
        });
    </script>
</body>
</html> 